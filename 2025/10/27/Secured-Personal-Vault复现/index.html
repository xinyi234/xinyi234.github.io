<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Secured Personal Vault复现 | Xinyi's blog</title><meta name="author" content="xinyi"><meta name="copyright" content="xinyi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="强网杯的一道misc题，但是是逆向 提取文件内核！蓝屏！驱动！ 首先用Windbg分析dmp文件 !analyze -v  综合所有信息，崩溃过程很可能是这样的：  用户 a 运行了桌面上的 aPersonalVault.exe 程序。 该程序加载了同目录下的 personalVaultKernel.sys 驱动程序到系统内核。 这个驱动程序存在严重的编程缺陷，在执行其功能时（很可能是在处理某个系">
<meta property="og:type" content="article">
<meta property="og:title" content="Secured Personal Vault复现">
<meta property="og:url" content="https://xinyi234.github.io/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/index.html">
<meta property="og:site_name" content="Xinyi&#39;s blog">
<meta property="og:description" content="强网杯的一道misc题，但是是逆向 提取文件内核！蓝屏！驱动！ 首先用Windbg分析dmp文件 !analyze -v  综合所有信息，崩溃过程很可能是这样的：  用户 a 运行了桌面上的 aPersonalVault.exe 程序。 该程序加载了同目录下的 personalVaultKernel.sys 驱动程序到系统内核。 这个驱动程序存在严重的编程缺陷，在执行其功能时（很可能是在处理某个系">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xinyi234.github.io/img/gudu3.jpg">
<meta property="article:published_time" content="2025-10-27T08:23:13.000Z">
<meta property="article:modified_time" content="2025-10-28T08:48:31.821Z">
<meta property="article:author" content="xinyi">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xinyi234.github.io/img/gudu3.jpg"><link rel="shortcut icon" href="/img/head.jpg"><link rel="canonical" href="https://xinyi234.github.io/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: '[object Object]',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Secured Personal Vault复现',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-color: #efefef;"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/head.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/gudu3.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/head.jpg" alt="Logo"><span class="site-name">Xinyi's blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Secured Personal Vault复现</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Secured Personal Vault复现</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-10-27T08:23:13.000Z" title="发表于 2025-10-27 16:23:13">2025-10-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-28T08:48:31.821Z" title="更新于 2025-10-28 16:48:31">2025-10-28</time></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>强网杯的一道misc题，但是是逆向</p>
<h1 id="提取文件"><a href="#提取文件" class="headerlink" title="提取文件"></a>提取文件</h1><p>内核！蓝屏！驱动！</p>
<p>首先用Windbg分析dmp文件</p>
<p><code>!analyze -v</code></p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251027163132323.png" alt="image-20251027163132323"></p>
<p>综合所有信息，崩溃过程很可能是这样的：</p>
<ol>
<li>用户 <code>a</code> 运行了桌面上的 <code>aPersonalVault.exe</code> 程序。</li>
<li>该程序加载了同目录下的 <code>personalVaultKernel.sys</code> 驱动程序到系统内核。</li>
<li>这个驱动程序存在严重的编程缺陷，在执行其功能时（很可能是在处理某个系统服务请求时），发生了内存访问违规（<code>c0000005</code>）。</li>
<li>由于这个错误发生在具有最高权限的内核模式，Windows 内核无法安全地处理它，为了阻止数据损坏或安全漏洞，立即触发了蓝屏死机（BugCheck 3B），并生成了你现在分析的 <code>MEMORY.DMP</code> 文件。</li>
<li>崩溃发生后，<code>aPersonalVault.exe</code> 和 <code>personalVaultKernel.sys</code> 可能被用户手动删除，或被安全软件作为可疑文件清除了。</li>
</ol>
<p><code>!process 0 0</code>列出所有进程，发现当前运行的是存在两个aPersonalVault.exe进程</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251027163339863.png" alt="image-20251027163339863"></p>
<p>下一步应该把引发蓝屏的exe dump出来</p>
<p><code>pip install volatility3</code></p>
<p><code>vol -f E:\MEMORY.dmp windows.filescan</code></p>
<p>找到了aPersonalVault.exe和personalVaultKernel.sys</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251027232124194.png" alt="image-20251027232124194"></p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251027231811551.png" alt="image-20251027231811551"></p>
<p>然后进行转储得到原始文件</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251027232517665.png" alt="image-20251027232517665"></p>
<h1 id="逆向分析"><a href="#逆向分析" class="headerlink" title="逆向分析"></a>逆向分析</h1><h2 id="sys驱动逆向"><a href="#sys驱动逆向" class="headerlink" title="sys驱动逆向"></a>sys驱动逆向</h2><p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251027234845891.png" alt="image-20251027234845891"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ds分析：这是一个Windows内核驱动程序的初始化函数（DriverEntry），主要完成以下工作：</span><br><span class="line"></span><br><span class="line">创建设备对象和符号链接 - 建立驱动程序与用户态的通信接口</span><br><span class="line">设置派遣函数 - 处理IRP请求和卸载例程</span><br><span class="line">枚举系统模块 - 查找ntoskrnl.exe内核模块</span><br><span class="line">函数挂钩 - 替换PsTerminateSystemThread系统函数</span><br><span class="line">错误处理 - 完善的资源清理机制</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntoskrnl.exe是Windows操作系统的一个重要内核程序，里面存储了大量的二进制内核代码，用于调度系统时使用，也是操作系统启动后第一个被加载的程序，通常该进程在任务管理器中显示为System</span><br></pre></td></tr></table></figure>

<p>遍历系统模块，寻找ntoskrnl.exe，获取HalPrivateDispatchTable的地址（从ntoskrnl.exe基地址偏移14682984处），把函数表中的HalTimerConvertAuxiliaryCounterToPerformanceCounter替换成sub_FFFFF80512BF10A0，获取到全局进程表并保存起来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">选择这个函数是攻击者在隐蔽性和功能性之间的平衡选择，既能够实现内核级控制，又不容易被常规安全检测发现。</span><br></pre></td></tr></table></figure>

<p>分析通信函数</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028095206440.png" alt="image-20251028095206440"></p>
<p>Signal如果是1就会触发蓝屏部分代码，Signal为2则遍历进程链表，寻找R3通信传来的对应Pid的EProcess，然后获取CreateTime数据返回到R3</p>
<p>通信数据的结构通过分析R3程序可以得到</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ComData</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    DWORD MagicNum;</span><br><span class="line">    DWORD Signal;</span><br><span class="line">    DWORD64 Pid;</span><br><span class="line">    DWORD64 RetData;</span><br><span class="line">    CHAR PAD[<span class="number">216</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ida恢复sys文件的结构体</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028102924257.png" alt="image-20251028102924257"></p>
<p>得到的代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_FFFFF80512BF10A0</span><span class="params">(ComData *ComData, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 (__fastcall *v3)(ComData *, __int64, __int64); <span class="comment">// rbp</span></span><br><span class="line">  DWORD n2; <span class="comment">// eax</span></span><br><span class="line">  _QWORD *v8; <span class="comment">// rax</span></span><br><span class="line">  DWORD64 Pid; <span class="comment">// rcx</span></span><br><span class="line"></span><br><span class="line">  v3 = (__int64 (__fastcall *)(ComData *, __int64, __int64))qword_FFFFF80512BF3348;</span><br><span class="line">  <span class="keyword">if</span> ( ExGetPreviousMode() &amp;&amp; ComData-&gt;MagicNum == <span class="number">0x30303030</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    n2 = ComData-&gt;Signal;</span><br><span class="line">    <span class="keyword">if</span> ( n2 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      process_list = <span class="number">0LL</span>;</span><br><span class="line">      qword_FFFFF80512BF3348 = <span class="number">0LL</span>;</span><br><span class="line">      ntoskrnl_base = <span class="number">0LL</span>;</span><br><span class="line">      MEMORY[<span class="number">0</span>] = <span class="number">0</span>;                            <span class="comment">// 触发蓝屏</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( n2 == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v8 = (_QWORD *)process_list;</span><br><span class="line">      Pid = ComData-&gt;Pid;</span><br><span class="line">      <span class="keyword">if</span> ( *(_QWORD *)(process_list + <span class="number">464</span>) != Pid )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">          v8 = (_QWORD *)(v8[<span class="number">59</span>] - <span class="number">472LL</span>);</span><br><span class="line">        <span class="keyword">while</span> ( v8[<span class="number">58</span>] != Pid );</span><br><span class="line">      &#125;</span><br><span class="line">      ComData-&gt;RetData = v8[<span class="number">63</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v3(ComData, a2, a3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">用户态程序调用HalTimerConvertAuxiliaryCounterToPerformanceCounter</span><br><span class="line">    ↓</span><br><span class="line">传递包含MagicNum和命令的结构体</span><br><span class="line">    ↓</span><br><span class="line">挂钩函数验证认证并处理命令</span><br><span class="line">    ↓</span><br><span class="line">返回内核数据或执行清理操作</span><br><span class="line">    ↓</span><br><span class="line">调用原始函数保持系统正常</span><br></pre></td></tr></table></figure>

<p>EPROCESS结构：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/1908456697376269654">从藏匿到曝光：EPROCESS如何成为恶意程序的终极战场？ - 知乎</a></p>
<h2 id="R3程序逆向"><a href="#R3程序逆向" class="headerlink" title="R3程序逆向"></a>R3程序逆向</h2><h3 id="加密流程"><a href="#加密流程" class="headerlink" title="加密流程"></a>加密流程</h3><p>之前windbg的分析可以知道系统中有两个apersonalVault进程，其中一个进程触发了蓝屏</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028104347859.png" alt="image-20251028104347859"></p>
<p>main函数负责与内核挂钩函数通信，进入sub_7FF611D11D10分析</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028104647171.png" alt="image-20251028104647171"> </p>
<p>这里看到了通信数据的结构体</p>
<p>CreateWindowExW函数创建窗口</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028110151836.png" alt="image-20251028110151836"></p>
<p>Create按钮处理：检查用户名和Secret是否为空，初始化ComData数据结构，调用内核函数进行通信，传递Signal是2，传过去的Pid是<code>GetCurrentProcessId</code>，也就是当前进程ID，驱动会返回当前进程的<code>CreateTime</code>数据，然后调用BCryptGenRandom随机初始化一个48字节的pbBuffer，用于后续的加密使用。</p>
<p>将随机的48字节作为两部分使用，前32字节作为Key，后16字节作为IV，对用户输入的Secret进行AES-CBC加密。</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028110612103.png" alt="image-20251028110612103"></p>
<p>加密完成后，将48字节异或驱动传过来的数据，相当于加密了密钥和IV</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028110638154.png" alt="image-20251028110638154"></p>
<p>创建邮件槽用于进程通信,存储密文信息</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">NumberOfBytesWritten = <span class="number">0</span>;           <span class="comment">// 创建邮件槽进行进程间通信</span></span><br><span class="line">            *(_OWORD *)Name = <span class="number">0LL</span>;</span><br><span class="line">            v19 = <span class="number">1</span>;</span><br><span class="line">            v20 = <span class="number">0</span>;</span><br><span class="line">            v71 = <span class="number">0LL</span>;</span><br><span class="line">            v21 = <span class="number">-1LL</span>;</span><br><span class="line">            v72 = <span class="number">0LL</span>;</span><br><span class="line">            v73 = <span class="number">0LL</span>;</span><br><span class="line">            v74 = <span class="number">0LL</span>;</span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">              ++v21;</span><br><span class="line">            <span class="keyword">while</span> ( String[v21] );              <span class="comment">// 计算用户名哈希</span></span><br><span class="line">            <span class="keyword">if</span> ( v21 )</span><br><span class="line">            &#123;</span><br><span class="line">              v22 = String;</span><br><span class="line">              <span class="keyword">do</span></span><br><span class="line">              &#123;</span><br><span class="line">                v23 = *v22++;</span><br><span class="line">                ++v20;</span><br><span class="line">                v19 = v23 * v19 + <span class="number">257</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">while</span> ( v20 &lt; v21 );</span><br><span class="line">            &#125;</span><br><span class="line">            sub_7FF611D11AD0(Name, <span class="number">0x50</span>uLL, <span class="string">&quot;\\\\.\\mailslot\\mailslot_%x&quot;</span>);<span class="comment">// 创建唯一邮件槽名称</span></span><br><span class="line">            <span class="keyword">if</span> ( hObject )</span><br><span class="line">              CloseHandle(hObject);</span><br><span class="line">            hObject = CreateMailslotA(Name, <span class="number">0</span>, <span class="number">0xFFFFFFFF</span>, <span class="number">0LL</span>);</span><br><span class="line">            FileA = CreateFileA(Name, GENERIC_WRITE, FILE_READ_DATA, <span class="number">0LL</span>, OPEN_EXISTING, FILE_READ_ATTRIBUTES, <span class="number">0LL</span>);<span class="comment">// 写入加密数据到邮件槽</span></span><br><span class="line">            WriteFile(FileA, lpBuffer_2, Size, &amp;NumberOfBytesWritten, <span class="number">0LL</span>);</span><br><span class="line">            CloseHandle(FileA);</span><br><span class="line">            <span class="built_in">memset</span>(lpBuffer_2, <span class="number">0</span>, Size);</span><br><span class="line">            *(_OWORD *)Buffer = <span class="number">0LL</span>;            <span class="comment">// 创建共享内存映射</span></span><br><span class="line">            v76 = <span class="number">0LL</span>;</span><br><span class="line">            v77 = <span class="number">0LL</span>;</span><br><span class="line">            v78 = <span class="number">0LL</span>;</span><br><span class="line">            v79 = <span class="number">0LL</span>;</span><br><span class="line">            sub_7FF611D11AD0(Buffer, <span class="number">0x50</span>uLL, <span class="string">&quot;Local\\mapping_%x&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> ( hObject_0 )</span><br><span class="line">              CloseHandle(hObject_0);</span><br><span class="line">            hObject_0 = CreateFileMappingA((HANDLE)<span class="number">0xFFFFFFFFFFFFFFFF</span>LL, <span class="number">0LL</span>, PAGE_READWRITE, <span class="number">0</span>, <span class="number">0x1000</span>u, Buffer);</span><br><span class="line">            lpBaseAddress = MapViewOfFile(hObject_0, <span class="number">6u</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0x1000</span>uLL);<span class="comment">// 在共享内存中存储邮件槽信息和进程ID</span></span><br><span class="line">            CurrentProcessId = GetCurrentProcessId();</span><br><span class="line">            *lpBaseAddress = hObject;</span><br><span class="line">            lpBaseAddress[<span class="number">1</span>] = CurrentProcessId;</span><br><span class="line">            UnmapViewOfFile(lpBaseAddress);</span><br><span class="line">            n64 = <span class="number">64</span>;</span><br><span class="line">            Success = <span class="string">L&quot;Success&quot;</span>;</span><br><span class="line">            User_created_successfully. = <span class="string">L&quot;User created successfully.&quot;</span>;</span><br><span class="line">            <span class="keyword">goto</span> LABEL_62;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h3 id="邮件槽"><a href="#邮件槽" class="headerlink" title="邮件槽"></a>邮件槽</h3><p>邮件槽（Mailslot）是Windows操作系统提供的一种简单的单向进程间通信（IPC）机制，只能一个进程写入，另一个进程读取</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/export_ibstfb.png" alt="export_ibstfb"></p>
<p>创建者写入的地址并不是一个内存地址，而是全局唯一的命名管道名称，计算用户名的哈希作为唯一标识，系统在内核中创建了一个名为<code>\\.\mailslot\mailslot_1234ABCD</code> 的邮件槽对象，创建者向这个地址写入加密数据存入邮件槽内核缓冲区。</p>
<p>读取者不知道创建者进程的邮件槽句柄，使用共享内存作为地址簿，创建者再共享内存中注册信息，读取者查找地址，读取数据</p>
<h3 id="解密流程"><a href="#解密流程" class="headerlink" title="解密流程"></a>解密流程</h3><p>Check按钮处理</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( !v5 )</span><br><span class="line">      &#123;</span><br><span class="line">        Success = <span class="string">L&quot;Input required&quot;</span>;</span><br><span class="line">        User_created_successfully. = <span class="string">L&quot;Please enter username.&quot;</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_61;</span><br><span class="line">      &#125;</span><br><span class="line">      NumberOfBytesRead = <span class="number">0</span>;                    <span class="comment">// 读取共享内存获取邮件槽信息</span></span><br><span class="line">      v30 = <span class="number">1</span>;</span><br><span class="line">      NumberOfBytesWritten = <span class="number">0</span>;</span><br><span class="line">      v31 = <span class="number">0</span>;</span><br><span class="line">      NextSize = <span class="number">0</span>;</span><br><span class="line">      *(_OWORD *)Name = <span class="number">0LL</span>;</span><br><span class="line">      v71 = <span class="number">0LL</span>;</span><br><span class="line">      v72 = <span class="number">0LL</span>;</span><br><span class="line">      v73 = <span class="number">0LL</span>;</span><br><span class="line">      v74 = <span class="number">0LL</span>;</span><br><span class="line">      v32 = String;                             <span class="comment">// 计算用户哈希</span></span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        v33 = *v32++;</span><br><span class="line">        ++v31;</span><br><span class="line">        v30 = v33 * v30 + <span class="number">257</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v31 &lt; v5 );</span><br><span class="line">      *(_OWORD *)Buffer = <span class="number">0LL</span>;                  <span class="comment">// 打开共享内存映射</span></span><br><span class="line">      v76 = <span class="number">0LL</span>;</span><br><span class="line">      v77 = <span class="number">0LL</span>;</span><br><span class="line">      v78 = <span class="number">0LL</span>;</span><br><span class="line">      v79 = <span class="number">0LL</span>;</span><br><span class="line">      sub_7FF611D11AD0(Buffer, <span class="number">0x50</span>uLL, <span class="string">&quot;Local\\mapping_%x&quot;</span>);</span><br><span class="line">      hFileMappingObject = OpenFileMappingA(<span class="number">6u</span>, <span class="number">0</span>, Buffer);</span><br><span class="line">      <span class="keyword">if</span> ( !hFileMappingObject )</span><br><span class="line">      &#123;</span><br><span class="line">        Success = <span class="string">L&quot;Error!&quot;</span>;</span><br><span class="line">        User_created_successfully. = <span class="string">L&quot;No username found...&quot;</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_61;</span><br><span class="line">      &#125;</span><br><span class="line">      v35 = MapViewOfFile(hFileMappingObject, <span class="number">6u</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0x1000</span>uLL);<span class="comment">// 获取邮件槽句柄和进程id</span></span><br><span class="line">      hSourceHandle = *(<span class="type">void</span> **)v35;</span><br><span class="line">      hSourceProcessHandle = OpenProcess(PROCESS_DUP_HANDLE, <span class="number">0</span>, v35[<span class="number">2</span>]);</span><br><span class="line">      CurrentProcess = GetCurrentProcess();</span><br><span class="line">      <span class="keyword">if</span> ( !DuplicateHandle(</span><br><span class="line">              hSourceProcessHandle,</span><br><span class="line">              hSourceHandle,</span><br><span class="line">              CurrentProcess,</span><br><span class="line">              &amp;TargetHandle,</span><br><span class="line">              <span class="number">0</span>,</span><br><span class="line">              <span class="number">0</span>,</span><br><span class="line">              DUPLICATE_SAME_ACCESS) )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_60;</span><br><span class="line">      GetMailslotInfo(TargetHandle, <span class="number">0LL</span>, &amp;NextSize, &amp;NumberOfBytesWritten, <span class="number">0LL</span>);</span><br><span class="line">      sub_7FF611D11A70(<span class="string">&quot;cbMessage: %llx; cMessage: %llx\n&quot;</span>, NextSize, NumberOfBytesWritten);</span><br><span class="line">      <span class="keyword">if</span> ( NextSize == <span class="number">-1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        Success = <span class="string">L&quot;No secret found!&quot;</span>;</span><br><span class="line">        User_created_successfully. = <span class="string">L&quot;No secret is in the box right now!!!&quot;</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_61;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( NumberOfBytesWritten != <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">LABEL_60:</span><br><span class="line">        Success = <span class="string">L&quot;Secret system is corrupted!&quot;</span>;</span><br><span class="line">        User_created_successfully. = <span class="string">L&quot;Something is wrong...&quot;</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_61;</span><br><span class="line">      &#125;</span><br><span class="line">      lpBuffer_3 = (<span class="type">char</span> *)j__malloc_base(NextSize);<span class="comment">// 读取加密数据</span></span><br><span class="line">      ReadFile(TargetHandle, lpBuffer_3, NextSize, &amp;NumberOfBytesRead, <span class="number">0LL</span>);</span><br><span class="line">      <span class="built_in">memset</span>(&amp;v80[<span class="number">2</span>], <span class="number">0</span>, <span class="number">0xF0</span>uLL);              <span class="comment">// 调用内核函数获取解密密钥</span></span><br><span class="line">      v80[<span class="number">0</span>] = <span class="number">0x230303030</span>LL;</span><br><span class="line">      v40 = GetCurrentProcessId();</span><br><span class="line">      v66 = <span class="number">0LL</span>;</span><br><span class="line">      v80[<span class="number">1</span>] = v40;</span><br><span class="line">      v67 = v80;</span><br><span class="line">      NtConvertBetweenAuxiliaryCounterAndPerformanceCounter(<span class="number">1LL</span>, &amp;v67, &amp;v66, <span class="number">0LL</span>);</span><br><span class="line">      v41 = v80[<span class="number">2</span>];</span><br><span class="line">      v42 = BYTE1(v80[<span class="number">2</span>]);</span><br><span class="line">      *(_WORD *)(&amp;pbBuffer + <span class="number">5</span>) ^= *(_WORD *)((<span class="type">char</span> *)&amp;v80[<span class="number">2</span>] + <span class="number">5</span>);<span class="comment">// 解密密钥</span></span><br><span class="line">      *(&amp;pbBuffer + <span class="number">7</span>) ^= HIBYTE(v80[<span class="number">2</span>]);</span><br><span class="line">      *(_WORD *)(&amp;pbBuffer + <span class="number">13</span>) ^= *(_WORD *)((<span class="type">char</span> *)&amp;v80[<span class="number">2</span>] + <span class="number">5</span>);</span><br><span class="line">      *(&amp;pbBuffer + <span class="number">15</span>) ^= HIBYTE(v80[<span class="number">2</span>]);</span><br><span class="line">      *(_WORD *)((<span class="type">char</span> *)&amp;xmmword_7FF611D36BB8 + <span class="number">5</span>) ^= *(_WORD *)((<span class="type">char</span> *)&amp;v80[<span class="number">2</span>] + <span class="number">5</span>);</span><br><span class="line">      BYTE7(xmmword_7FF611D36BB8) ^= HIBYTE(v80[<span class="number">2</span>]);</span><br><span class="line">      *(_WORD *)((<span class="type">char</span> *)&amp;xmmword_7FF611D36BB8 + <span class="number">13</span>) ^= *(_WORD *)((<span class="type">char</span> *)&amp;v80[<span class="number">2</span>] + <span class="number">5</span>);</span><br><span class="line">      HIBYTE(xmmword_7FF611D36BB8) ^= HIBYTE(v80[<span class="number">2</span>]);</span><br><span class="line">      *(_WORD *)((<span class="type">char</span> *)&amp;xmmword_7FF611D36BC8 + <span class="number">5</span>) ^= *(_WORD *)((<span class="type">char</span> *)&amp;v80[<span class="number">2</span>] + <span class="number">5</span>);</span><br><span class="line">      BYTE7(xmmword_7FF611D36BC8) ^= HIBYTE(v80[<span class="number">2</span>]);</span><br><span class="line">      *(_WORD *)((<span class="type">char</span> *)&amp;xmmword_7FF611D36BC8 + <span class="number">13</span>) ^= *(_WORD *)((<span class="type">char</span> *)&amp;v80[<span class="number">2</span>] + <span class="number">5</span>);</span><br><span class="line">      pbBuffer ^= LOBYTE(v80[<span class="number">2</span>]);</span><br><span class="line">      *(_DWORD *)(&amp;pbBuffer + <span class="number">1</span>) ^= *(_DWORD *)((<span class="type">char</span> *)&amp;v80[<span class="number">2</span>] + <span class="number">1</span>);</span><br><span class="line">      *(&amp;pbBuffer + <span class="number">8</span>) ^= LOBYTE(v80[<span class="number">2</span>]);</span><br><span class="line">      *(_DWORD *)(&amp;pbBuffer + <span class="number">9</span>) ^= *(_DWORD *)((<span class="type">char</span> *)&amp;v80[<span class="number">2</span>] + <span class="number">1</span>);</span><br><span class="line">      LOBYTE(xmmword_7FF611D36BB8) = LOBYTE(v80[<span class="number">2</span>]) ^ xmmword_7FF611D36BB8;</span><br><span class="line">      *(_DWORD *)((<span class="type">char</span> *)&amp;xmmword_7FF611D36BB8 + <span class="number">1</span>) ^= *(_DWORD *)((<span class="type">char</span> *)&amp;v80[<span class="number">2</span>] + <span class="number">1</span>);</span><br><span class="line">      BYTE8(xmmword_7FF611D36BB8) ^= LOBYTE(v80[<span class="number">2</span>]);</span><br><span class="line">      *(_DWORD *)((<span class="type">char</span> *)&amp;xmmword_7FF611D36BB8 + <span class="number">9</span>) ^= *(_DWORD *)((<span class="type">char</span> *)&amp;v80[<span class="number">2</span>] + <span class="number">1</span>);</span><br><span class="line">      LOBYTE(xmmword_7FF611D36BC8) = LOBYTE(v80[<span class="number">2</span>]) ^ xmmword_7FF611D36BC8;</span><br><span class="line">      *(_DWORD *)((<span class="type">char</span> *)&amp;xmmword_7FF611D36BC8 + <span class="number">1</span>) ^= *(_DWORD *)((<span class="type">char</span> *)&amp;v80[<span class="number">2</span>] + <span class="number">1</span>);</span><br><span class="line">      BYTE8(xmmword_7FF611D36BC8) ^= LOBYTE(v80[<span class="number">2</span>]);</span><br><span class="line">      *(_DWORD *)((<span class="type">char</span> *)&amp;xmmword_7FF611D36BC8 + <span class="number">9</span>) ^= *(_DWORD *)((<span class="type">char</span> *)&amp;v80[<span class="number">2</span>] + <span class="number">1</span>);</span><br><span class="line">      HIBYTE(xmmword_7FF611D36BC8) ^= HIBYTE(v80[<span class="number">2</span>]);</span><br><span class="line">      v60 = <span class="number">0LL</span>;</span><br><span class="line">      v59 = xmmword_7FF611D36BB8;</span><br><span class="line">      v58 = *(_OWORD *)&amp;pbBuffer;</span><br><span class="line">      *((_QWORD *)&amp;v43 + <span class="number">1</span>) = *((_QWORD *)&amp;xmmword_7FF611D36BC8 + <span class="number">1</span>);</span><br><span class="line">      *(<span class="type">double</span> *)&amp;v43 = sub_7FF611D11000(v81, &amp;v58);</span><br><span class="line">      lpBuffer_4 = lpBuffer_3;                  <span class="comment">// AES解密</span></span><br><span class="line">      v81[<span class="number">15</span>] = v43;</span><br><span class="line">      <span class="keyword">if</span> ( NextSize )</span><br><span class="line">      &#123;</span><br><span class="line">        v45 = (<span class="type">char</span> *)((<span class="type">char</span> *)&amp;v81[<span class="number">15</span>] - lpBuffer_3);</span><br><span class="line">        v46 = (((<span class="type">unsigned</span> __int64)NextSize - <span class="number">1</span>) &gt;&gt; <span class="number">4</span>) + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">          v47 = *lpBuffer_4;</span><br><span class="line">          sub_7FF611D118E0(lpBuffer_4, v81);</span><br><span class="line">          n16_1 = <span class="number">16LL</span>;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">          &#123;</span><br><span class="line">            *(_BYTE *)lpBuffer_4 ^= *((_BYTE *)lpBuffer_4 + (_QWORD)v45);</span><br><span class="line">            lpBuffer_4 = (_OWORD *)((<span class="type">char</span> *)lpBuffer_4 + <span class="number">1</span>);</span><br><span class="line">            --n16_1;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">while</span> ( n16_1 );</span><br><span class="line">          v45 -= <span class="number">16</span>;</span><br><span class="line">          v81[<span class="number">15</span>] = v47;</span><br><span class="line">          --v46;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> ( v46 );</span><br><span class="line">        v42 = BYTE1(v80[<span class="number">2</span>]);</span><br><span class="line">        v41 = v80[<span class="number">2</span>];</span><br><span class="line">      &#125;</span><br><span class="line">      *((_DWORD *)&amp;pbBuffer + <span class="number">1</span>) ^= HIDWORD(v80[<span class="number">2</span>]);</span><br><span class="line">      *((_DWORD *)&amp;pbBuffer + <span class="number">3</span>) ^= HIDWORD(v80[<span class="number">2</span>]);</span><br><span class="line">      DWORD1(xmmword_7FF611D36BB8) ^= HIDWORD(v80[<span class="number">2</span>]);</span><br><span class="line">      HIDWORD(xmmword_7FF611D36BB8) ^= HIDWORD(v80[<span class="number">2</span>]);</span><br><span class="line">      DWORD1(xmmword_7FF611D36BC8) ^= HIDWORD(v80[<span class="number">2</span>]);</span><br><span class="line">      HIDWORD(xmmword_7FF611D36BC8) ^= HIDWORD(v80[<span class="number">2</span>]);</span><br><span class="line">      pbBuffer ^= v41;</span><br><span class="line">      *(&amp;pbBuffer + <span class="number">1</span>) ^= v42;</span><br><span class="line">      *((_WORD *)&amp;pbBuffer + <span class="number">1</span>) ^= WORD1(v80[<span class="number">2</span>]);</span><br><span class="line">      *(&amp;pbBuffer + <span class="number">8</span>) ^= v41;</span><br><span class="line">      *(&amp;pbBuffer + <span class="number">9</span>) ^= v42;</span><br><span class="line">      *((_WORD *)&amp;pbBuffer + <span class="number">5</span>) ^= WORD1(v80[<span class="number">2</span>]);</span><br><span class="line">      LOBYTE(xmmword_7FF611D36BB8) = v41 ^ xmmword_7FF611D36BB8;</span><br><span class="line">      BYTE1(xmmword_7FF611D36BB8) ^= v42;</span><br><span class="line">      WORD1(xmmword_7FF611D36BB8) ^= WORD1(v80[<span class="number">2</span>]);</span><br><span class="line">      BYTE8(xmmword_7FF611D36BB8) ^= v41;</span><br><span class="line">      BYTE9(xmmword_7FF611D36BB8) ^= v42;</span><br><span class="line">      WORD5(xmmword_7FF611D36BB8) ^= WORD1(v80[<span class="number">2</span>]);</span><br><span class="line">      LOBYTE(xmmword_7FF611D36BC8) = v41 ^ xmmword_7FF611D36BC8;</span><br><span class="line">      BYTE1(xmmword_7FF611D36BC8) ^= v42;</span><br><span class="line">      WORD1(xmmword_7FF611D36BC8) ^= WORD1(v80[<span class="number">2</span>]);</span><br><span class="line">      BYTE8(xmmword_7FF611D36BC8) ^= v41;</span><br><span class="line">      BYTE9(xmmword_7FF611D36BC8) ^= v42;</span><br><span class="line">      WORD5(xmmword_7FF611D36BC8) ^= WORD1(v80[<span class="number">2</span>]);</span><br><span class="line">      <span class="built_in">memset</span>(v80, <span class="number">0</span>, <span class="keyword">sizeof</span>(v80));</span><br><span class="line">      <span class="keyword">if</span> ( NextSize )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (NextSize &amp; <span class="number">0xF</span>) == <span class="number">0</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v49 = &amp;lpBuffer_3[NextSize - <span class="number">1</span>];</span><br><span class="line">          v50 = (<span class="type">unsigned</span> __int8)*v49;</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)(v50 - <span class="number">1</span>) &lt;= <span class="number">0xF</span>u )</span><br><span class="line">          &#123;</span><br><span class="line">            v51 = <span class="number">0LL</span>;</span><br><span class="line">            <span class="keyword">if</span> ( !(_BYTE)v50 )</span><br><span class="line">            &#123;</span><br><span class="line">LABEL_55:</span><br><span class="line">              v52 = NextSize - v50;</span><br><span class="line">              <span class="keyword">goto</span> LABEL_57;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> ( *v49 == (_BYTE)v50 )</span><br><span class="line">            &#123;</span><br><span class="line">              ++v51;</span><br><span class="line">              --v49;</span><br><span class="line">              <span class="keyword">if</span> ( v51 &gt;= v50 )</span><br><span class="line">                <span class="keyword">goto</span> LABEL_55;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      v52 = <span class="number">0</span>;</span><br><span class="line">LABEL_57:</span><br><span class="line">      <span class="keyword">if</span> ( v52 )                                <span class="comment">// 显示解密结果</span></span><br><span class="line">      &#123;</span><br><span class="line">        lpBuffer_3[v52] = <span class="number">0</span>;</span><br><span class="line">        MessageBoxA(hWndParent, lpBuffer_3, <span class="string">&quot;Secret&quot;</span>, <span class="number">0x40</span>u);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span>                                      <span class="comment">// 解密失败</span></span><br><span class="line">      &#123;</span><br><span class="line">        sub_7FF611D11AD0(Name, <span class="number">0x50</span>uLL, <span class="string">&quot;\\\\.\\mailslot\\mailslot_%x&quot;</span>);</span><br><span class="line">        hFile = CreateFileA(Name, GENERIC_WRITE, FILE_READ_DATA, <span class="number">0LL</span>, OPEN_EXISTING, FILE_READ_ATTRIBUTES, <span class="number">0LL</span>);</span><br><span class="line">        WriteFile(hFile, lpBuffer_3, NextSize, lpNumberOfBytesWritten, <span class="number">0LL</span>);</span><br><span class="line">        CloseHandle(hFile);</span><br><span class="line">        <span class="built_in">memset</span>(lpBuffer_3, <span class="number">0</span>, NextSize);</span><br><span class="line">        <span class="built_in">memset</span>((<span class="type">char</span> *)v81 + <span class="number">8</span>, <span class="number">0</span>, <span class="number">0xF8</span>uLL);</span><br><span class="line">        *(_QWORD *)&amp;v81[<span class="number">0</span>] = <span class="number">0x130303030</span>LL;</span><br><span class="line">        v69 = v81;</span><br><span class="line">        v68 = <span class="number">0LL</span>;</span><br><span class="line">        NtConvertBetweenAuxiliaryCounterAndPerformanceCounter(<span class="number">1LL</span>, &amp;v69, &amp;v68, <span class="number">0LL</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> DefWindowProcW(hWndParent, Msg, wParam, lParam);</span><br><span class="line">    &#125;</span><br><span class="line">    PostQuitMessage(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取当前用户名并计算用户名hash，打开创建邮件槽时映射的内存，拿到邮件槽的句柄，调用ReadFile获取密文</p>
<p>与内核通信获取当前进程的<code>CreateTime</code>，异或解密刚刚被异或加密的pbBuffer，也就是（Key+IV）共48字节。</p>
<p>将解密的数据与输入的secret进行比对，正确则输出secret窗口，不正确就打开当前用户名的邮件槽，将解密数据写回邮件槽，设置Signal&#x3D;1,触发了驱动的地址异常，触发了蓝屏</p>
<p>所以触发蓝屏的原因是：输入用户名解密secret时，解密出的数据与当时输入的明文不匹配。我们从windbg中发现内存中有两个apersonalVault进程，两个进程分别输入了两个不同的用户名创建了两个邮件槽，其中一个进程输入了另一个进程的用户名，得到了另一个进程的密文，这个密文不是用它的密钥加密的，所以肯定无法正确解密，比对失败后Signal&#x3D;1,触发蓝屏</p>
<p>如何解密：获取两个进程中被加密的48字节数据(key+IV),再获取两个进程的CreateTime,异或解密出真正的key和IV</p>
<p>获取两个进程的邮件槽中存储的密文</p>
<p>进程1的密文直接用进程1的key和IV进行AES-CBC解密出明文</p>
<p>进程2的密文由于被进程1误解密过一次并覆盖到邮件槽，所以先用进程1的key和IV加密一次，再用进程2的Key和IV解密出明文</p>
<h3 id="数据提取"><a href="#数据提取" class="headerlink" title="数据提取"></a>数据提取</h3><p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028132711060.png" alt="image-20251028132711060"></p>
<p>找到了pbBuffer在程序中的地址</p>
<p>windbg中找到两个进程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PROCESS ffffef063fbe8080</span><br><span class="line">    SessionId: none  Cid: 0fa8    Peb: 9f83185000  ParentCid: 14b0</span><br><span class="line">    DirBase: 840fe000  ObjectTable: ffffa687a7241740  HandleCount: 161.</span><br><span class="line">    Image: aPersonalVault.exe</span><br><span class="line"></span><br><span class="line">PROCESS ffffef063fbc1080</span><br><span class="line">    SessionId: none  Cid: 26f0    Peb: 9216e1a000  ParentCid: 14b0</span><br><span class="line">    DirBase: 1296dc000  ObjectTable: ffffa687a6dd3b40  HandleCount: 165.</span><br><span class="line">    Image: aPersonalVault.exe</span><br></pre></td></tr></table></figure>

<p>先使用<code>.process /r /p Eprocess地址</code>，切换到对应进程，然后通过偏移读取数据</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028133350490.png" alt="image-20251028133350490"></p>
<p><code>lm vm aPersonalVault</code>查看进程模块信息，可以看到aPersonalVault的两个进程基址是0x00007ff611d10000</p>
<p>查看了进程1的密钥，切换进程后查看进程2的密钥</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028134025384.png" alt="image-20251028134025384"></p>
<p>CreateTime获取：<code>dt nt!_EPROCESS ffffef063fbe8080</code></p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028134502257.png" alt="image-20251028134502257"></p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028134704545.png" alt="image-20251028134704545"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">进程1：0x01dc3fe6ed454439</span><br><span class="line">进程2：0x01dc3fe6f02a77eb</span><br></pre></td></tr></table></figure>

<p>密文获取</p>
<p>查看邮件槽句柄的地址</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028140353307.png" alt="image-20251028140353307"></p>
<p>切换进程，读取进程1和进程2中邮件槽句柄</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028141459562.png" alt="image-20251028141459562"></p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028141408189.png" alt="image-20251028141408189"></p>
<p>两个句柄分别是0x27C和0x280</p>
<p>获取该进程0x27c句柄的信息</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028141709390.png" alt="image-20251028141709390"></p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028162827492.png" alt="image-20251028162827492"></p>
<p>\mailslot_e60a23e2是邮件槽的唯一标识名，Object地址是ffffe70b7f057380，按文件对象的结构进行解析</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028142706844.png" alt="image-20251028142706844"></p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028162930357.png" alt="image-20251028162930357"></p>
<p>DeviceObject说明这个文件对象 <code>ffffe70b7f057380</code> 关联到设备对象 <code>ffffef063d2d9770</code>，所有对该文件对象的 I&#x2F;O 操作最终都会路由到这个设备对象处理</p>
<p>点击DeviceObject,发现它是Msfs驱动</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028145500937.png" alt="image-20251028145500937"></p>
<h3 id="Msfs分析"><a href="#Msfs分析" class="headerlink" title="Msfs分析"></a>Msfs分析</h3><p>分析本机的msfs.sys</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028160411866.png" alt="image-20251028160411866"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IRP_MJ_CREATE_NAMED_PIPE (2) - 创建命名管道请求处理</span></span><br><span class="line">  DriverObject-&gt;MajorFunction[<span class="number">2</span>] = (PDRIVER_DISPATCH)&amp;DispatchCreateNamedPipe;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// IRP_MJ_READ (3) - 读请求处理</span></span><br><span class="line">  DriverObject-&gt;MajorFunction[<span class="number">3</span>] = (PDRIVER_DISPATCH)DispatchRead;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// IRP_MJ_WRITE (4) - 写请求处理</span></span><br><span class="line">  DriverObject-&gt;MajorFunction[<span class="number">4</span>] = (PDRIVER_DISPATCH)&amp;DispatchWrite;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// IRP_MJ_QUERY_INFORMATION (5) - 查询信息请求处理</span></span><br><span class="line">  DriverObject-&gt;MajorFunction[<span class="number">5</span>] = (PDRIVER_DISPATCH)&amp;DispatchQueryInformation;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// IRP_MJ_SET_INFORMATION (6) - 设置信息请求处理</span></span><br><span class="line">  DriverObject-&gt;MajorFunction[<span class="number">6</span>] = (PDRIVER_DISPATCH)&amp;DispatchSetInformation;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// IRP_MJ_QUERY_VOLUME_INFORMATION (10) - 查询卷信息请求处理</span></span><br><span class="line">  DriverObject-&gt;MajorFunction[<span class="number">10</span>] = (PDRIVER_DISPATCH)DispatchQueryVolumeInformation;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// IRP_MJ_DIRECTORY_CONTROL (18) - 目录控制请求处理</span></span><br><span class="line">  DriverObject-&gt;MajorFunction[<span class="number">18</span>] = (PDRIVER_DISPATCH)&amp;DispatchDirectoryControl;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// IRP_MJ_DEVICE_CONTROL (12) - 设备控制请求处理</span></span><br><span class="line">  DriverObject-&gt;MajorFunction[<span class="number">12</span>] = (PDRIVER_DISPATCH)DispatchDeviceControl;</span><br></pre></td></tr></table></figure>

<p>转到读处理函数分析</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028161022717.png" alt="image-20251028161022717"></p>
<p>FsContext + 0x118处存储了数据，进入sub_1C000A0A0</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">_QWORD *__fastcall <span class="title function_">PerformSyncRead</span><span class="params">(</span></span><br><span class="line"><span class="params">        _QWORD *IoStatusBlock,</span></span><br><span class="line"><span class="params">        ULONG_PTR FileControlBlock,</span></span><br><span class="line"><span class="params">        <span class="type">int</span> ReadFlags,</span></span><br><span class="line"><span class="params">        __int64 UserBuffer,</span></span><br><span class="line"><span class="params">        <span class="type">unsigned</span> <span class="type">int</span> RequestedLength,</span></span><br><span class="line"><span class="params">        _DWORD *BytesNeeded)</span></span><br><span class="line">&#123;</span><br><span class="line">  ULONG_PTR DataBlock; <span class="comment">// r14</span></span><br><span class="line">  __int64 DataBuffer; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> DataSize; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> BytesToCopy; <span class="comment">// eax</span></span><br><span class="line">  __int64 CopiedBytes; <span class="comment">// rdi</span></span><br><span class="line">  ULONG_PTR ErrorParameter; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化IO状态块</span></span><br><span class="line">  *IoStatusBlock = <span class="number">0LL</span>;</span><br><span class="line">  IoStatusBlock[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取数据块指针（文件控制块+24处的指针减去8）</span></span><br><span class="line">  DataBlock = *(_QWORD *)(FileControlBlock + <span class="number">24</span>) - <span class="number">8LL</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取数据缓冲区和数据大小</span></span><br><span class="line">  DataBuffer = *(_QWORD *)(DataBlock + <span class="number">40</span>);</span><br><span class="line">  DataSize = *(_DWORD *)(DataBlock + <span class="number">32</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 检查请求长度是否足够</span></span><br><span class="line">  <span class="keyword">if</span> ( RequestedLength &lt; DataSize )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( ReadFlags != <span class="number">4</span> )  <span class="comment">// 如果不是部分读取模式</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 返回缓冲区太小的错误</span></span><br><span class="line">      *(_DWORD *)IoStatusBlock = STATUS_BUFFER_TOO_SMALL;  <span class="comment">// 0xC0000023</span></span><br><span class="line">      <span class="keyword">return</span> IoStatusBlock;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 部分读取模式，设置状态为缓冲区溢出</span></span><br><span class="line">    *(_DWORD *)IoStatusBlock = STATUS_BUFFER_OVERFLOW;  <span class="comment">// 0x80000005</span></span><br><span class="line">    BytesToCopy = RequestedLength;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 请求长度足够，复制全部数据</span></span><br><span class="line">    BytesToCopy = *(_DWORD *)(DataBlock + <span class="number">32</span>);  <span class="comment">// DataSize</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 实际字节数</span></span><br><span class="line">  CopiedBytes = BytesToCopy;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 执行内存复制：从数据缓冲区复制到用户缓冲区</span></span><br><span class="line">  MemoryCopy(UserBuffer, DataBuffer, BytesToCopy);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 设置需要的字节数（原始数据大小）</span></span><br><span class="line">  *BytesNeeded = *(_DWORD *)(DataBlock + <span class="number">32</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 如果是完整读取且缓冲区足够大</span></span><br><span class="line">  <span class="keyword">if</span> ( DataSize &lt;= RequestedLength )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( ReadFlags != <span class="number">4</span> )  <span class="comment">// 如果不是部分读取模式</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 验证数据块的完整性</span></span><br><span class="line">      ErrorParameter = ValidateDataBlock(FileControlBlock, DataBlock);</span><br><span class="line">      <span class="keyword">if</span> ( ErrorParameter )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 如果验证失败，触发系统崩溃（BugCheck）</span></span><br><span class="line">        KeBugCheckEx(</span><br><span class="line">          <span class="number">0x52</span>u,           <span class="comment">// FAT_FILE_SYSTEM</span></span><br><span class="line">          <span class="number">1uLL</span>,            <span class="comment">// 错误代码</span></span><br><span class="line">          ErrorParameter,   <span class="comment">// 错误参数1</span></span><br><span class="line">          FileControlBlock, <span class="comment">// 错误参数2  </span></span><br><span class="line">          DataBlock        <span class="comment">// 错误参数3</span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置成功状态</span></span><br><span class="line">    *(_DWORD *)IoStatusBlock = STATUS_SUCCESS;  <span class="comment">// 0</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 设置实际复制的字节数</span></span><br><span class="line">  IoStatusBlock[<span class="number">1</span>] = CopiedBytes;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> IoStatusBlock;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Context+0x18处是其数据的<code>LIST_ENTRY</code>，<code>- 8</code>则是原始数据结构的头部，<code>+ 0x28</code>则是数据指针，<code>+ 0x20</code>则是数据长度</p>
<p>list_entry</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028161747407.png" alt="image-20251028161747407"></p>
<p>data length</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028161929790.png" alt="image-20251028161929790"></p>
<p>data ptr</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028162030011.png" alt="image-20251028162030011"></p>
<p>密文为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">密文_1080：</span><br><span class="line">95 c2 4e 06 41 92 cf 1c-52 18 01 32 86 4e 38 5e  </span><br><span class="line">e2 ee 24 7b 68 0f dc be-7e 14 3b ee 47 fd 22 13  </span><br><span class="line">b3 71 1c 1b 40 08 e2 b3-ff 78 34 eb e5 3e 7d 53  </span><br><span class="line">48 53 59 16 74 46 f5 8b-eb 9d 96 1c 57 13 5e bb  </span><br><span class="line">2a 18 fa 30 98 29 23 db-99 73 d6 ac 4b 01 88 c5  </span><br><span class="line">7e 38 b0 a5 8d 3e 71 b0-fe c9 8e 7b d8 e3 0c 2c  </span><br><span class="line">27 07 b9 94 94 68 53 af-71 98 84 3b 89 ac 21 de  </span><br><span class="line">56 67 7c c3 e6 cf 43 b8-d6 d5 39 61 5c 76 31 79 </span><br><span class="line">密文_8080:</span><br><span class="line">3c 5b 7d 22 a8 62 ff 7e-89 ef f9 6d 26 e3 d3 e6 </span><br><span class="line">2f c3 9d ff 8a c5 4c 0b-e2 d1 02 47 39 45 96 83  </span><br><span class="line">46 ce 20 68 f6 0a f0 65-2b 5b 85 be 4f dc f5 63  </span><br><span class="line">ee e2 74 9f 4e 07 71 29-03 94 7e 5a b0 bf 66 75  </span><br><span class="line">6c 4b 9c d7 c2 10 fd 45-4d a9 65 36 84 02 f9 8e</span><br></pre></td></tr></table></figure>

<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028162155076.png" alt="image-20251028162155076"></p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028163207874.png" alt="image-20251028163207874"></p>
<h2 id="解密"><a href="#解密" class="headerlink" title="解密"></a>解密</h2><p>需要的数据已经得到，开始解密</p>
<p>首先把48字节和对应的CreateTime异或得到真正的key和IV</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    EncKeyIV_8080 = [<span class="number">0x45</span>, <span class="number">0x71</span>, <span class="number">0x9c</span>, <span class="number">0x96</span>, <span class="number">0xf3</span>, <span class="number">0x11</span>, <span class="number">0x80</span>, <span class="number">0x2e</span>, <span class="number">0x9d</span>, <span class="number">0xac</span>, <span class="number">0xf2</span>, <span class="number">0x94</span>, <span class="number">0x64</span>, <span class="number">0x4e</span>, <span class="number">0xc7</span>, <span class="number">0xe5</span>,</span><br><span class="line">                     <span class="number">0x52</span>, <span class="number">0xa4</span>, <span class="number">0x46</span>, <span class="number">0x35</span>, <span class="number">0x5e</span>, <span class="number">0x86</span>, <span class="number">0x72</span>, <span class="number">0x75</span>, <span class="number">0xa9</span>, <span class="number">0xb7</span>, <span class="number">0xbf</span>, <span class="number">0x80</span>, <span class="number">0x52</span>, <span class="number">0xd0</span>, <span class="number">0x06</span>, <span class="number">0xa2</span>,</span><br><span class="line">                     <span class="number">0xc9</span>, <span class="number">0x62</span>, <span class="number">0xdd</span>, <span class="number">0x9c</span>, <span class="number">0xf2</span>, <span class="number">0xee</span>, <span class="number">0x60</span>, <span class="number">0x5e</span>, <span class="number">0xa0</span>, <span class="number">0x6b</span>, <span class="number">0x4c</span>, <span class="number">0xcf</span>, <span class="number">0xb5</span>, <span class="number">0xef</span>, <span class="number">0x0d</span>, <span class="number">0x82</span>]</span><br><span class="line">    CreateTime_8080 = <span class="number">0x01dc3fe6ed454439</span></span><br><span class="line"></span><br><span class="line">    EncKeyIV_1080 = [<span class="number">0x20</span>, <span class="number">0x51</span>, <span class="number">0xb5</span>, <span class="number">0x07</span>, <span class="number">0x07</span>, <span class="number">0x70</span>, <span class="number">0xb8</span>, <span class="number">0x0e</span>, <span class="number">0xfc</span>, <span class="number">0xa3</span>, <span class="number">0x9c</span>, <span class="number">0x30</span>, <span class="number">0x54</span>, <span class="number">0x92</span>, <span class="number">0xd6</span>, <span class="number">0x44</span>,</span><br><span class="line">                     <span class="number">0x9d</span>, <span class="number">0x08</span>, <span class="number">0xe2</span>, <span class="number">0x02</span>, <span class="number">0xfe</span>, <span class="number">0x81</span>, <span class="number">0xd1</span>, <span class="number">0xf6</span>, <span class="number">0x70</span>, <span class="number">0xb6</span>, <span class="number">0x86</span>, <span class="number">0x35</span>, <span class="number">0x20</span>, <span class="number">0xb4</span>, <span class="number">0xa6</span>, <span class="number">0x6e</span>,</span><br><span class="line">                     <span class="number">0xaf</span>, <span class="number">0x40</span>, <span class="number">0xdf</span>, <span class="number">0x21</span>, <span class="number">0xda</span>, <span class="number">0x73</span>, <span class="number">0x21</span>, <span class="number">0x01</span>, <span class="number">0x3a</span>, <span class="number">0xfa</span>, <span class="number">0x99</span>, <span class="number">0x1c</span>, <span class="number">0xe6</span>, <span class="number">0x56</span>, <span class="number">0x69</span>, <span class="number">0x00</span>]</span><br><span class="line">    CreateTime_1080 = <span class="number">0x01dc3fe6f02a77eb</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对8080数据进行异或解密</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">48</span>, <span class="number">8</span>):</span><br><span class="line">        <span class="comment"># 将8个字节转换为64位整数</span></span><br><span class="line">        current_value = struct.unpack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="built_in">bytes</span>(EncKeyIV_1080[i:i+<span class="number">8</span>]))[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># 异或操作</span></span><br><span class="line">        xored_value = current_value ^ CreateTime_1080</span><br><span class="line">        <span class="comment"># 将结果转换回字节并替换原数据</span></span><br><span class="line">        xored_bytes = struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, xored_value)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            EncKeyIV_1080[i + j] = xored_bytes[j]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对1080数据进行异或解密</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">48</span>, <span class="number">8</span>):</span><br><span class="line">        <span class="comment"># 将8个字节转换为64位整数</span></span><br><span class="line">        current_value = struct.unpack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="built_in">bytes</span>(EncKeyIV_8080[i:i+<span class="number">8</span>]))[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># 异或操作</span></span><br><span class="line">        xored_value = current_value ^ CreateTime_8080</span><br><span class="line">        <span class="comment"># 将结果转换回字节并替换原数据</span></span><br><span class="line">        xored_bytes = struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, xored_value)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            EncKeyIV_8080[i + j] = xored_bytes[j]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;AES Key_1(8080): &quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;EncKeyIV_1080[i]:02X&#125;</span> &quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;AES IV_1(8080): &quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">48</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;EncKeyIV_1080[i]:02X&#125;</span> &quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;AES Key_2(1080): &quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;EncKeyIV_8080[i]:02X&#125;</span> &quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;AES IV_2(1080): &quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">48</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;EncKeyIV_8080[i]:02X&#125;</span> &quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AES Key_1(8080): 7C 35 D9 7B 15 2E 5C 2F A4 E8 B7 79 82 71 1B E4 6B E0 03 D8 B8 B9 AE 74 90 F3 FA 6D B4 EF DA A3 </span><br><span class="line">AES IV_1(8080): F0 26 98 71 14 D1 BC 5F 99 2F 09 22 53 D0 D1 83 </span><br><span class="line">AES Key_2(1080): CB 26 9F F7 E1 4F 64 0F 17 D4 B6 C0 B2 AD 0A 45 76 7F C8 F2 18 BE 0D F7 9B C1 AC C5 C6 8B 7A 6F </span><br><span class="line">AES IV_2(1080): 44 37 F5 D1 3C 4C FD 00 D1 8D B3 EC 00 69 B5 01 </span><br></pre></td></tr></table></figure>

<p>密文1解出来一句话</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028163945644.png" alt="image-20251028163945644"></p>
<p>密文2</p>
<p><img src="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/image-20251028164812895.png" alt="image-20251028164812895"></p>
<p>flag{Making_challenge_is_hard_manage_a_secure_vault_is_more_difficult} 得到flag</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://xinyi234.github.io">xinyi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://xinyi234.github.io/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/">https://xinyi234.github.io/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://xinyi234.github.io" target="_blank">Xinyi's blog</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/gudu3.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/10/22/%E5%85%B3%E4%BA%8Epython%E9%80%86%E5%90%91/" title="关于python逆向"><img class="cover" src="/img/gudu3.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">关于python逆向</div></div><div class="info-2"><div class="info-item-1">之前入门过python逆向，在比赛中发现这两个工具并不能反编译所有的pyinstaller打包的exe,特别是3.12之后的版本 关于ycb的两道py逆向2025羊城杯初赛re 完整wp - 霍雅的博客 ez_py其中一个附件是key.exe,用pyinstrator解包得到key.pyc  python3.13反编译不完整 https://www.52pojie.cn/thread-2025482-1-1.html Pylingual网站反编译的代码 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576# Decompiled with PyLingual (https://pylingual.io)# Internal filename: key.py# Bytecode version: 3.13.0rc3 (3571)# Source...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">xinyi</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xinyi234"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/xinyi234" target="_blank" title="Github"><i class="fab fa-github" style="color: #ffffff;"></i></a><a class="social-icon" href="mailto:lijialin8917@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #ffffff;"></i></a><a class="social-icon" href="/3630016869" target="_blank" title="QQ"><i class="fa fa-qq" style="color: #ffffff;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8F%90%E5%8F%96%E6%96%87%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">提取文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%86%E5%90%91%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">逆向分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sys%E9%A9%B1%E5%8A%A8%E9%80%86%E5%90%91"><span class="toc-number">2.1.</span> <span class="toc-text">sys驱动逆向</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#R3%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91"><span class="toc-number">2.2.</span> <span class="toc-text">R3程序逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E6%B5%81%E7%A8%8B"><span class="toc-number">2.2.1.</span> <span class="toc-text">加密流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%82%AE%E4%BB%B6%E6%A7%BD"><span class="toc-number">2.2.2.</span> <span class="toc-text">邮件槽</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%AF%86%E6%B5%81%E7%A8%8B"><span class="toc-number">2.2.3.</span> <span class="toc-text">解密流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8F%90%E5%8F%96"><span class="toc-number">2.2.4.</span> <span class="toc-text">数据提取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Msfs%E5%88%86%E6%9E%90"><span class="toc-number">2.2.5.</span> <span class="toc-text">Msfs分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%AF%86"><span class="toc-number">2.3.</span> <span class="toc-text">解密</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/" title="Secured Personal Vault复现"><img src="/img/gudu3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Secured Personal Vault复现"/></a><div class="content"><a class="title" href="/2025/10/27/Secured-Personal-Vault%E5%A4%8D%E7%8E%B0/" title="Secured Personal Vault复现">Secured Personal Vault复现</a><time datetime="2025-10-27T08:23:13.000Z" title="发表于 2025-10-27 16:23:13">2025-10-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/22/%E5%85%B3%E4%BA%8Epython%E9%80%86%E5%90%91/" title="关于python逆向"><img src="/img/gudu3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="关于python逆向"/></a><div class="content"><a class="title" href="/2025/10/22/%E5%85%B3%E4%BA%8Epython%E9%80%86%E5%90%91/" title="关于python逆向">关于python逆向</a><time datetime="2025-10-22T03:05:58.000Z" title="发表于 2025-10-22 11:05:58">2025-10-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/15/2025%E7%BE%8A%E5%9F%8E%E6%9D%AF%E5%A4%8D%E7%8E%B0/" title="2025羊城杯复现"><img src="/img/gudu3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2025羊城杯复现"/></a><div class="content"><a class="title" href="/2025/10/15/2025%E7%BE%8A%E5%9F%8E%E6%9D%AF%E5%A4%8D%E7%8E%B0/" title="2025羊城杯复现">2025羊城杯复现</a><time datetime="2025-10-15T11:19:20.000Z" title="发表于 2025-10-15 19:19:20">2025-10-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E5%AE%9E%E8%B7%B5/" title="操作系统设计实践"><img src="/img/bingwu1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="操作系统设计实践"/></a><div class="content"><a class="title" href="/2025/09/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E5%AE%9E%E8%B7%B5/" title="操作系统设计实践">操作系统设计实践</a><time datetime="2025-09-08T06:12:30.000Z" title="发表于 2025-09-08 14:12:30">2025-09-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/18/LILCTF-Re-Crypto/" title="LILCTF-Re&amp;Crypto"><img src="/img/bingwu1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LILCTF-Re&amp;Crypto"/></a><div class="content"><a class="title" href="/2025/08/18/LILCTF-Re-Crypto/" title="LILCTF-Re&amp;Crypto">LILCTF-Re&amp;Crypto</a><time datetime="2025-08-18T02:33:15.000Z" title="发表于 2025-08-18 10:33:15">2025-08-18</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By xinyi</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/"></script><div class="js-pjax"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script></div></body></html>